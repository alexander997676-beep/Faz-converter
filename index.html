<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAZ Bento Dashboard</title>
    
    <!-- Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Html2Canvas for Screenshot -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        :root {
            --bg-body: #0f0f11;
            --card-bg: #18181b;
            --card-hover: #202024;
            --border: #27272a;
            --primary: #6366f1; /* Indigo */
            --accent: #ec4899;  /* Pink */
            --text-main: #ffffff;
            --text-muted: #a1a1aa;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* --- BENTO GRID LAYOUT --- */
        .bento-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(3, auto);
            gap: 16px;
            width: 100%;
            max-width: 1000px;
        }

        /* Card Styles */
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            background-color: var(--card-hover);
            transform: translateY(-2px);
            border-color: #3f3f46;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .card-title {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- GRID PLACEMENTS --- */
        /* 1. Main Converter (Top Left - Large) */
        .area-main { grid-column: span 2; grid-row: span 2; }
        
        /* 2. Graph (Top Right - Wide) */
        .area-graph { grid-column: span 2; grid-row: span 1; }

        /* 3. Cheat Sheet (Bottom Left) */
        .area-cheat { grid-column: span 1; grid-row: span 2; }

        /* 4. Inverse Rate (Middle Right) */
        .area-inverse { grid-column: span 1; grid-row: span 1; }
        
        /* 5. Actions (Bottom Right) */
        .area-actions { grid-column: span 2; grid-row: span 1; }

        /* Mobile Responsive */
        @media (max-width: 900px) {
            .bento-container { grid-template-columns: 1fr; display: flex; flex-direction: column; }
            .card { min-height: 180px; }
            .area-main { order: 1; }
            .area-actions { order: 2; }
            .area-graph { order: 3; min-height: 250px; }
            .area-cheat { order: 4; }
            .area-inverse { order: 5; }
        }

        /* --- COMPONENT STYLES --- */
        
        /* Main Converter */
        .input-wrapper { margin-bottom: 15px; }
        .big-input {
            width: 100%;
            background: transparent;
            border: none;
            color: white;
            font-size: 3.5rem;
            font-weight: 800;
            outline: none;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }
        .big-input::placeholder { color: #333; }
        
        .currency-row { display: flex; gap: 10px; margin-top: auto; }
        select {
            flex: 1;
            background: #27272a;
            border: 1px solid var(--border);
            color: white;
            padding: 12px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            outline: none;
        }
        .swap-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 46px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
        }
        .swap-btn:hover { background: #4f46e5; transform: rotate(180deg); }

        /* Result Text in Main Card */
        .live-result {
            font-size: 1.2rem;
            color: var(--primary);
            margin-top: 10px;
            font-weight: 600;
        }

        /* Cheat Sheet Table */
        .cheat-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .cheat-table td { padding: 8px 0; border-bottom: 1px solid #27272a; }
        .cheat-table tr:last-child td { border-bottom: none; }
        .ct-val { text-align: right; font-weight: 600; color: var(--text-main); }
        .ct-lbl { color: var(--text-muted); }

        /* Inverse Rate */
        .inv-val { font-size: 2rem; font-weight: 700; color: var(--accent); }
        .inv-desc { font-size: 0.8rem; color: var(--text-muted); margin-top: 5px; }

        /* Actions */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; height: 100%; }
        .act-btn {
            background: #27272a;
            border: 1px solid var(--border);
            color: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.2s;
        }
        .act-btn.primary { background: linear-gradient(135deg, var(--primary), #4f46e5); border: none; }
        .act-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }

        /* Loader */
        .spinner {
            width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white; border-radius: 50%; animation: spin 1s infinite linear;
            display: none;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

<div class="bento-container" id="dashboard">

    <!-- 1. MAIN CONVERTER -->
    <div class="card area-main">
        <div class="card-title">
            <i class="fas fa-wallet"></i> FAZ BENTO
            <div class="spinner" id="loader"></div>
        </div>
        
        <div class="input-wrapper">
            <input type="number" class="big-input" id="amount" value="100" placeholder="0">
            <div style="font-size: 0.9rem; color: var(--text-muted);">Enter Amount</div>
        </div>

        <div class="live-result" id="main-result">100 USD = ... PKR</div>

        <div class="currency-row">
            <select id="from" onchange="convert()">
                <option value="USD">USD - US Dollar</option>
                <option value="EUR">EUR - Euro</option>
                <option value="GBP">GBP - Pound</option>
                <option value="PKR">PKR - Rupee</option>
                <option value="INR">INR - Rupee</option>
                <option value="AED">AED - Dirham</option>
                <option value="CNY">CNY - Yuan</option>
            </select>
            <button class="swap-btn" onclick="swap()"><i class="fas fa-exchange-alt"></i></button>
            <select id="to" onchange="convert()">
                <option value="PKR" selected>PKR - Rupee</option>
                <option value="USD">USD - US Dollar</option>
                <option value="EUR">EUR - Euro</option>
                <option value="GBP">GBP - Pound</option>
                <option value="INR">INR - Rupee</option>
                <option value="AED">AED - Dirham</option>
                <option value="CAD">CAD - Canadian</option>
            </select>
        </div>
    </div>

    <!-- 2. GRAPH -->
    <div class="card area-graph">
        <div class="card-title">Market Trend (7D)</div>
        <div style="flex:1; position: relative;">
            <canvas id="trendChart"></canvas>
        </div>
    </div>

    <!-- 3. CHEAT SHEET -->
    <div class="card area-cheat">
        <div class="card-title"><i class="fas fa-list-ul"></i> Cheat Sheet</div>
        <table class="cheat-table" id="cheat-sheet-body">
            <tr><td class="ct-lbl">1 <span class="u-from">USD</span></td><td class="ct-val">...</td></tr>
            <tr><td class="ct-lbl">10 <span class="u-from">USD</span></td><td class="ct-val">...</td></tr>
            <tr><td class="ct-lbl">50 <span class="u-from">USD</span></td><td class="ct-val">...</td></tr>
            <tr><td class="ct-lbl">100 <span class="u-from">USD</span></td><td class="ct-val">...</td></tr>
            <tr><td class="ct-lbl">500 <span class="u-from">USD</span></td><td class="ct-val">...</td></tr>
        </table>
    </div>

    <!-- 4. INVERSE RATE -->
    <div class="card area-inverse">
        <div class="card-title"><i class="fas fa-retweet"></i> Inverse Rate</div>
        <div style="margin: auto 0;">
            <div class="inv-val" id="inv-val">...</div>
            <div class="inv-desc" id="inv-desc">1 PKR = ... USD</div>
        </div>
    </div>

    <!-- 5. ACTIONS -->
    <div class="card area-actions">
        <div class="action-grid">
            <button class="act-btn primary" onclick="convert(true)">
                <i class="fas fa-sync-alt"></i> Refresh Rates
            </button>
            <button class="act-btn" onclick="takeScreenshot()">
                <i class="fas fa-camera"></i> Save Image
            </button>
        </div>
    </div>

</div>

<script>
    // --- SETUP CHART ---
    const ctx = document.getElementById('trendChart').getContext('2d');
    let trendChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['M', 'T', 'W', 'T', 'F', 'S', 'S'],
            datasets: [{
                data: [10, 11, 10.5, 12, 11.5, 12.5, 13], // Dummy start
                borderColor: '#6366f1',
                borderWidth: 3,
                tension: 0.4,
                pointRadius: 0,
                fill: true,
                backgroundColor: 'rgba(99, 102, 241, 0.1)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false } }
        }
    });

    // --- MAIN LOGIC ---
    let debounceTimer;
    
    // Auto convert on typing with delay
    document.getElementById('amount').addEventListener('input', () => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => convert(), 500);
    });

    function swap() {
        const f = document.getElementById('from');
        const t = document.getElementById('to');
        const temp = f.value;
        f.value = t.value;
        t.value = temp;
        convert();
    }

    async function convert(forceRefetch = false) {
        const amount = document.getElementById('amount').value || 0;
        const from = document.getElementById('from').value;
        const to = document.getElementById('to').value;
        const loader = document.getElementById('loader');
        
        loader.style.display = 'block';

        const url = `https://api.xyro.site/currency/convert?amount=${amount}&from=${from}&to=${to}`;

        try {
            const res = await fetch(url);
            const json = await res.json();
            
            loader.style.display = 'none';

            if(json.status) {
                // 1. Parse Result
                let val = 0;
                // Handling API variations
                if(typeof json.data === 'number') val = json.data;
                else if(json.data.result) val = json.data.result;
                else if(json.data.converted) val = json.data.converted;
                else if(json.data.rate) val = json.data.rate * amount;

                // Calculate Single Unit Rate
                const unitRate = amount > 0 ? val / amount : 0;

                // 2. Update Main Display
                const formatted = val.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                document.getElementById('main-result').innerHTML = `<span style="color:white; font-size:1.5em; font-weight:800">${formatted}</span> ${to}`;

                // 3. Update Cheat Sheet
                updateCheatSheet(unitRate, from, to);

                // 4. Update Inverse
                if(unitRate > 0) {
                    const inverse = (1 / unitRate).toFixed(6);
                    document.getElementById('inv-val').innerText = inverse;
                    document.getElementById('inv-desc').innerText = `1 ${to} = ${inverse} ${from}`;
                }

                // 5. Update Chart (Simulation)
                updateChartSimulation(unitRate);

            }
        } catch(e) {
            console.error(e);
            loader.style.display = 'none';
        }
    }

    function updateCheatSheet(rate, from, to) {
        const multipliers = [1, 10, 50, 100, 500];
        const tbody = document.getElementById('cheat-sheet-body');
        
        // Update Labels (From currency code)
        document.querySelectorAll('.u-from').forEach(el => el.innerText = from);

        // Update Values (Rows)
        const rows = tbody.querySelectorAll('tr');
        rows.forEach((row, index) => {
            if(multipliers[index]) {
                const val = (rate * multipliers[index]).toLocaleString(undefined, {maximumFractionDigits: 2});
                row.querySelector('.ct-val').innerText = `${val} ${to}`;
            }
        });
    }

    function updateChartSimulation(base) {
        // Create realistic fluctuation
        const data = [];
        for(let i=0; i<7; i++) {
            const variance = (Math.random() - 0.5) * (base * 0.05);
            data.push(base + variance);
        }
        // Force last point to match current
        data[6] = base; 
        
        trendChart.data.datasets[0].data = data;
        trendChart.update();
    }

    function takeScreenshot() {
        const btn = document.querySelector('.area-actions');
        // Hide buttons temporarily
        btn.style.opacity = '0';
        
        html2canvas(document.getElementById('dashboard'), {
            backgroundColor: '#0f0f11'
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'FAZ-Bento-Dashboard.png';
            link.href = canvas.toDataURL();
            link.click();
            btn.style.opacity = '1';
        });
    }

    // Initial Load
    convert();
</script>

</body>
</html>
